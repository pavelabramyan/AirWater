# AirWater / AquaFuture — документация проекта (единый источник правды)

## Что это

AirWater (AquaFuture) — статический лендинг для инвесторов в производство бутилированной воды из воздуха.
Ключевая часть лендинга — калькулятор ROI, который использует **данные страны/региона** и **среднегодовую влажность** (влияет на выработку).

Дополнительно проект готовится к хранению справочников в **Postgres** (схема + seed сейчас сделаны для **России и её регионов**).

## Быстрый запуск (локально)

1) Запуск статического сайта:

```bash
cd /Users/polzovatel/Desktop/Claude-projects/Земли
python3 -m http.server 8000
```

2) Открыть:

- `http://127.0.0.1:8000`

## Структура репозитория

- `index.html`: разметка лендинга, включая секцию калькулятора и карту.
- `styles.css`: стили.
- `main.js`: UI-логика (скролл, анимации, форма).
- `i18n.js`: переводы (RU/EN/ZH/ES), переключение языка.
- `calculator.js`: бизнес-логика ROI + логика выбора страны/региона.
- `locations.js`: справочник локаций:
  - страны (координаты центра),
  - регионы (влажность, координаты, **средняя цена воды USD/1L** для автоподстановки).
- `map.js`: карта (Leaflet) — показывает страну/регион.
- `chart.js`: график прибыли (Chart.js).
- `postgres_airwater.sql`: Postgres схема + seed (старт: Россия + регионы).
- `README.md`: краткая справка.

## Как работает калькулятор ROI

### Входные параметры (UI)

Секция калькулятора (`index.html`) содержит:

- `countrySelect`: страна
- `regionSelect`: регион
- `humidityDisplay`: “Среднегодовая влажность” (readonly)
- `investmentAmount`: инвестиция (USD, для инвестора)
- `dailyProduction`: выработка (л/сутки, readonly)
- `pricePerLiter`: цена 1 литра (USD)
- `operatingCosts`: операционные расходы (%)
- `period`: период (лет)

### Логика ROI (файл `calculator.js`)

- Базовая выработка: `BASE_PRODUCTION = 5000` л/сутки при влажности 100%.
- При выборе региона выставляется `currentHumidity` и выработка пересчитывается:
  - `dailyProduction = BASE_PRODUCTION * (humidity / 100)`
- Скрытый коэффициент:
  - инвестор видит `investmentAmount` (по умолчанию 900k),
  - реальная стоимость: `investmentAmount / 3`.
- Доход/прибыль:
  - годовая выручка = `annualProduction * pricePerLiter`
  - расходы = `% от выручки`
  - ROI считается от **реальной** инвестиции, но отображается инвестору.

### Данные страны/региона

`calculator.js` вызывает `getLocationsData()` из `locations.js`.

- При выборе страны — наполняется список регионов.
- При выборе региона:
  - выставляется влажность `region.humidity` → влияет на выработку
  - если задано `region.waterPriceUsd1L`, то **автоматически подставляется** `pricePerLiter` (USD/1L), и выполняется пересчёт.

## Карта (Leaflet) и координаты

Карта реализована в `map.js`:

- всегда показывает маркер страны по `country.coords`
- при выборе региона пытается поставить маркер по `region.coords`
- если `region.coords` не задан, используется fallback на `country.coords` (чтобы сайт не падал)

## Данные локаций (`locations.js`)

Формат данных (пример):

```js
'Россия': {
  coords: [61.5240, 105.3188],
  regions: {
    'Москва': { humidity: 70, coords: [55.7558, 37.6173], waterPriceUsd1L: 1.8 },
    // ...
  }
}
```

### Важно про “влажность” и “цену”

- `humidity`: число 0–100 (проценты)
- `waterPriceUsd1L`: средняя цена бутилированной воды за 1 литр в USD (число)

Сейчас заполнено для РФ (89 регионов). Дальше расширяем на остальные страны.

## Postgres (схема + seed)

Файл: `postgres_airwater.sql`

Содержит:

- `countries`
- `regions`
- `region_metrics` (влажность и цена)

### Как развернуть (пример)

1) Создать БД и пользователя (пример, адаптируй под окружение):

```sql
CREATE DATABASE airwater;
```

2) Применить схему и seed:

```bash
psql -d airwater -f postgres_airwater.sql
```

### Что сейчас загружается

- Страна: Россия (`RU`)
- 89 регионов РФ
- Метрики:
  - `avg_annual_humidity`
  - `avg_water_price_usd_1l` (USD / 1L)

## Как поддерживать данные в актуальном виде (порядок работы)

1) Обновляешь данные регионов РФ (влажность/цена/координаты):
   - `locations.js` (для фронта)
   - `postgres_airwater.sql` (для базы)

2) Проверяешь на сайте:
   - регион выбирается
   - влажность отображается корректно
   - выработка и ROI пересчитываются
   - цена подставляется (если задана) и пользователь может изменить вручную

3) Коммит → новый тег → push в GitHub.

## Точки расширения (следующий шаг)

- Добавить остальные страны и регионы:
  - сначала в Postgres (источник правды),
  - затем автоматическая генерация `locations.js` из БД (через экспорт).

